// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries.sql

package db

import (
	"context"
	"time"
)

const createDetection = `-- name: CreateDetection :one
INSERT INTO detections (id, device_id, label, confidence)
VALUES (DEFAULT, $1, $2, $3)
RETURNING id, device_id, created_at, label, confidence
`

type CreateDetectionParams struct {
	DeviceID   int64   `db:"device_id" json:"device_id"`
	Label      string  `db:"label" json:"label"`
	Confidence float64 `db:"confidence" json:"confidence"`
}

// ---------------
// Detections
// ---------------
func (q *Queries) CreateDetection(ctx context.Context, arg CreateDetectionParams) (Detection, error) {
	row := q.db.QueryRow(ctx, createDetection, arg.DeviceID, arg.Label, arg.Confidence)
	var i Detection
	err := row.Scan(
		&i.ID,
		&i.DeviceID,
		&i.CreatedAt,
		&i.Label,
		&i.Confidence,
	)
	return i, err
}

const createDevice = `-- name: CreateDevice :one
INSERT INTO devices (id, name, device_url)
VALUES (DEFAULT, $1, $2)
RETURNING id, name, device_url
`

type CreateDeviceParams struct {
	Name      string `db:"name" json:"name"`
	DeviceUrl string `db:"device_url" json:"device_url"`
}

func (q *Queries) CreateDevice(ctx context.Context, arg CreateDeviceParams) (Device, error) {
	row := q.db.QueryRow(ctx, createDevice, arg.Name, arg.DeviceUrl)
	var i Device
	err := row.Scan(&i.ID, &i.Name, &i.DeviceUrl)
	return i, err
}

const createTestDevice = `-- name: CreateTestDevice :one
INSERT INTO devices (id, name, device_url)
VALUES (DEFAULT, 'mockdevice', 'http://localhost:8080')
RETURNING id, name, device_url
`

func (q *Queries) CreateTestDevice(ctx context.Context) (Device, error) {
	row := q.db.QueryRow(ctx, createTestDevice)
	var i Device
	err := row.Scan(&i.ID, &i.Name, &i.DeviceUrl)
	return i, err
}

const deleteBeats = `-- name: DeleteBeats :exec
DELETE
FROM device_heartbeats
WHERE device_id = $1
`

func (q *Queries) DeleteBeats(ctx context.Context, deviceID int64) error {
	_, err := q.db.Exec(ctx, deleteBeats, deviceID)
	return err
}

const deleteDetections = `-- name: DeleteDetections :exec
DELETE
FROM detections
WHERE device_id = $1
`

func (q *Queries) DeleteDetections(ctx context.Context, deviceID int64) error {
	_, err := q.db.Exec(ctx, deleteDetections, deviceID)
	return err
}

const getDetectionsAfter = `-- name: GetDetectionsAfter :many
SELECT id, device_id, created_at, label, confidence
FROM detections
WHERE created_at >= $1
ORDER BY created_at DESC
`

func (q *Queries) GetDetectionsAfter(ctx context.Context, createdAt time.Time) ([]Detection, error) {
	rows, err := q.db.Query(ctx, getDetectionsAfter, createdAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Detection{}
	for rows.Next() {
		var i Detection
		if err := rows.Scan(
			&i.ID,
			&i.DeviceID,
			&i.CreatedAt,
			&i.Label,
			&i.Confidence,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getDeviceById = `-- name: GetDeviceById :one
SELECT id, name, device_url
FROM devices
WHERE id = $1
LIMIT 1
`

func (q *Queries) GetDeviceById(ctx context.Context, id int32) (Device, error) {
	row := q.db.QueryRow(ctx, getDeviceById, id)
	var i Device
	err := row.Scan(&i.ID, &i.Name, &i.DeviceUrl)
	return i, err
}

const getDeviceDetectionsAfter = `-- name: GetDeviceDetectionsAfter :many
SELECT id, device_id, created_at, label, confidence
FROM detections
WHERE device_id = $1
  AND created_at >= $2
ORDER BY created_at DESC
`

type GetDeviceDetectionsAfterParams struct {
	DeviceID  int64     `db:"device_id" json:"device_id"`
	CreatedAt time.Time `db:"created_at" json:"created_at"`
}

func (q *Queries) GetDeviceDetectionsAfter(ctx context.Context, arg GetDeviceDetectionsAfterParams) ([]Detection, error) {
	rows, err := q.db.Query(ctx, getDeviceDetectionsAfter, arg.DeviceID, arg.CreatedAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Detection{}
	for rows.Next() {
		var i Detection
		if err := rows.Scan(
			&i.ID,
			&i.DeviceID,
			&i.CreatedAt,
			&i.Label,
			&i.Confidence,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getDeviceHeartBeats = `-- name: GetDeviceHeartBeats :many

SELECT id, device_id, created_at
FROM device_heartbeats
WHERE device_id = $1
  and created_at >= $2
ORDER BY created_at DESC
`

type GetDeviceHeartBeatsParams struct {
	DeviceID  int64     `db:"device_id" json:"device_id"`
	CreatedAt time.Time `db:"created_at" json:"created_at"`
}

// ---------------
// HeartBeats
// ---------------
func (q *Queries) GetDeviceHeartBeats(ctx context.Context, arg GetDeviceHeartBeatsParams) ([]DeviceHeartbeat, error) {
	rows, err := q.db.Query(ctx, getDeviceHeartBeats, arg.DeviceID, arg.CreatedAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []DeviceHeartbeat{}
	for rows.Next() {
		var i DeviceHeartbeat
		if err := rows.Scan(&i.ID, &i.DeviceID, &i.CreatedAt); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getDevices = `-- name: GetDevices :many
SELECT id, name, device_url
FROM devices
order by name
`

func (q *Queries) GetDevices(ctx context.Context) ([]Device, error) {
	rows, err := q.db.Query(ctx, getDevices)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Device{}
	for rows.Next() {
		var i Device
		if err := rows.Scan(&i.ID, &i.Name, &i.DeviceUrl); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const heartBeatsAfter = `-- name: HeartBeatsAfter :many
SELECT id, device_id, created_at
FROM device_heartbeats
WHERE created_at >= $1
ORDER BY created_at DESC
`

func (q *Queries) HeartBeatsAfter(ctx context.Context, createdAt time.Time) ([]DeviceHeartbeat, error) {
	rows, err := q.db.Query(ctx, heartBeatsAfter, createdAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []DeviceHeartbeat{}
	for rows.Next() {
		var i DeviceHeartbeat
		if err := rows.Scan(&i.ID, &i.DeviceID, &i.CreatedAt); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const latestBeats = `-- name: LatestBeats :many
SELECT DISTINCT(device_heartbeats.device_id), device_heartbeats.created_at, devices.id, devices.name, devices.device_url
FROM device_heartbeats
         JOIN devices ON devices.id = device_heartbeats.device_id
ORDER BY device_heartbeats.created_at DESC
`

type LatestBeatsRow struct {
	DeviceID  int64     `db:"device_id" json:"device_id"`
	CreatedAt time.Time `db:"created_at" json:"created_at"`
	ID        int32     `db:"id" json:"id"`
	Name      string    `db:"name" json:"name"`
	DeviceUrl string    `db:"device_url" json:"device_url"`
}

func (q *Queries) LatestBeats(ctx context.Context) ([]LatestBeatsRow, error) {
	rows, err := q.db.Query(ctx, latestBeats)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []LatestBeatsRow{}
	for rows.Next() {
		var i LatestBeatsRow
		if err := rows.Scan(
			&i.DeviceID,
			&i.CreatedAt,
			&i.ID,
			&i.Name,
			&i.DeviceUrl,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const recordBeat = `-- name: RecordBeat :one
INSERT INTO device_heartbeats (id, device_id, created_at)
VALUES (DEFAULT, $1, now())
RETURNING id, device_id, created_at
`

func (q *Queries) RecordBeat(ctx context.Context, deviceID int64) (DeviceHeartbeat, error) {
	row := q.db.QueryRow(ctx, recordBeat, deviceID)
	var i DeviceHeartbeat
	err := row.Scan(&i.ID, &i.DeviceID, &i.CreatedAt)
	return i, err
}

const updateDevice = `-- name: UpdateDevice :exec
UPDATE devices
SET name       = $2,
    device_url = $3
WHERE id = $1
`

type UpdateDeviceParams struct {
	ID        int32  `db:"id" json:"id"`
	Name      string `db:"name" json:"name"`
	DeviceUrl string `db:"device_url" json:"device_url"`
}

func (q *Queries) UpdateDevice(ctx context.Context, arg UpdateDeviceParams) error {
	_, err := q.db.Exec(ctx, updateDevice, arg.ID, arg.Name, arg.DeviceUrl)
	return err
}
